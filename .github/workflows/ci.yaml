name: MGC SDK CI

on:
  push:
    branches: [ main ]
  pull_request:
    types:
      - opened
      - synchronize
      - reopened
      - ready_for_review

concurrency:
  group: ci-check-${{ github.ref }}
  cancel-in-progress: true

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v3
        - uses: actions/setup-go@v4
          with:
            go-version: '>=1.17.0'
            cache-dependency-path: "**/go.sum"
        - run: go version
        - name: Instal CLI Dependencies
          run: go install ./mgc/cli
        - name: Build CLI
          run: go build -o /tmp/cli ./mgc/cli

    pre-commit:
        needs: build
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v3
        - uses: actions/setup-python@v3
        - name: "Install go imports"
          run: go install golang.org/x/tools/cmd/goimports@latest
        - uses: actions/setup-go@v4
          with:
            go-version: '>=1.17.0'
            cache-dependency-path: "**/go.sum"
        - uses: pre-commit/action@v3.0.0
          with:
            extra_args: --show-diff-on-failure --color=always --hook-stage push --all-files
