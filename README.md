# MGC

This repository contains the monorepo developed for Magalu Cloud (MGC). Each subdirectory within [mgc/](./mgc) corresponds to a Go module:

- **[Core](./mgc/core)**: Definition of data types used for the intermediate
  structure generated by the SDK after parsing either an OpenAPI spec or a static
  definition.

- **[SDK](./mgc/sdk/)**: Implement the concrete data types defined by core
  to generate usable commands. The commands can be used by the CLI via Cobra commands, or
  by Terraform Plugin Provider to perform CRUD on resources.

- **[CLI](./mgc/cli)**: Go CLI, using Cobra, with commands and actions defined by
  the SDK. The commands can either come from dynamic loaded OpenAPI spec or static
  modules, i.e: authentication.

Our code is written in Golang, however there are some utility scripts written
in Python as well.

**Looking for Terraform code? Check out the [Terraform provider](https://github.com/MagaluCloud/terraform-provider-mgc) repository**

## Dependencies

To run the project, the main dependency needed is [Go](https://go.dev/dl/). To
install, visit the official link with the instructions.


## Building and running locally

Building needs [goreleaser](https://goreleaser.com/install/) and can be done using Makefile targets.

If you have API spec changes, update them on `specs`, on the corresponding product and run

```bash
$ make refresh-specs
```

After that (or if there are no further spec changes), build the CLI with:

```bash
$ make build-local
```

If all goes well, the output binary will be a platform-dependent directory, where it can be run:

```bash
$ cd dist/mgc_<your_platform>
$ ./mgc
```

Alternatively, you can compile the project using only Golang's native tools, without relying on Goreleaser:

```bash
$ make build-go
```

## OpenAPI

See [sdk/openapi/README.md](./mgc/sdk/openapi/README.md)

## Adding new APIs

### OpenAPIs

To add a new API spec, see [ADD_NEW_API.md](ADD_NEW_API.mdd).

### Static APIs

Manually written APIs should be added to `mgc/sdk/static`, follow the
structure in the exiting modules (`auth`, `config`).

## Contributing

### pre-commit

We use [Lefthook](https://github.com/evilmartians/lefthook) to install git hooks and enforce
lint, formatting, tests, commit messages and others. 
#### Installation

```sh
make pre-commit-install
```


### Run manually

Run pre-commit without any file modified:

```sh
make pre-commit
```
